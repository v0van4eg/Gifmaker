---
- name: Установка дополнительных пакетов
  dnf:
    name:
      - curl
      - python3-pip
    state: present

- name: Настройка дополнительных пакетов python
  pip:
    name: docker
    state: present

- name: Создаём daemon.json
  copy:
    dest: /etc/docker/daemon.json
    content: |
      {
        "log-driver": "journald",
        "icc": false,
        "disable-validation": true,
        "bip": "10.99.0.1/16",
        "fixed-cidr": "10.99.0.0/16",
        "insecure-registries": ["http://redc1:4000"]
      }
    mode: '0644'
  notify: Restart Docker

- name: Проверка live-restore включен или нет в Docker daemon configuration
  shell: |
    if grep -q '"live-restore":\s*true' /etc/docker/daemon.json; then
      echo "enabled"
    else
      echo "disabled"
    fi
  register: live_restore_status
  changed_when: false

- name: Выключение live-restore в Docker daemon configuration
  lineinfile:
    path: /etc/docker/daemon.json
    regexp: '"live-restore":\s*true'
    state: absent
  when: live_restore_status.stdout == "enabled"






